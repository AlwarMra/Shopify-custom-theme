console.log("::::::CART MUESTRAS:::::"),DT.cart={add_to_cart:function(t,a=!1){fetch("/cart/add.js",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(t=>{console.log(" producto add_to_cart response-> ",t),a&&a(),DT.mini_cart.get_cart(DT.mini_cart.format_mini_cart,!0)})},checkout:function(){$(".go-checkout").addClass("loading-btn");var t="attributes[catalogue]="+window.promo_assets.catalogue+"&attributes[flyer]="+window.promo_assets.flyer;console.log("checkout>>>>>",window.promo_assets,t),$.post("/cart/update.js",t).done(function(){DT.cart.check_cart(function(){document.location="/checkout"})})},check_cart:function(e=!1){console.log("[CART CHECK] cart",DT.mini_cart.cart);var a=[];_.each(DT.mini_cart.cart.items,function(t){"false"!==t.properties._is_free&&a.push({id:t.id,product_id:t.product_id,variant_id:t.variant_id,properties:t.properties,sku:t.sku,q:t.quantity})}),console.log("[CART CHECK]",a),$.post("https://blacklabelparfum.com/sfapp/addmuestra/cart_check.php",{tienda:window.country,itemsCart:a}).done(function(t){console.log("[CART CHECK]->GET",t);t=JSON.parse(t);if("OK-CHECK"==t.status){console.log("[CART CHECK]->OK-CHECK",t.variants_ids_lack);let a=[];_.each(t.variants_ids_lack,function(t){console.log("[CART CHECK]->GET item",t),a.push("updates["+t.id+"]="+t.quantity)});t=a.join("&");console.log("[CART CHECK]->GET updates_string",t),$.post("/cart/update.js",t).done(function(t){console.log("[CART CHECK]->GET update",t),e&&e()})}else e&&e()})}},DT.mini_cart={init:function(){$("#openModal").on("click",()=>DT.mini_cart.openCart()),DT.mini_cart.get_cart(DT.mini_cart.format_mini_cart,!1),$(document).on("click",".cart-qty-control-minicart, .btn_quantity",function(t){t.preventDefault(),console.log("---cart-qty-control-minicart---"),DT.mini_cart.updateQty($(this))}),$(document).on("click",".cart-remove",function(t){t.preventDefault(),DT.mini_cart.updateQty($(this))}),764<=window.innerWidth&&$(document).on("click","#btn_open_side_cart",function(t){t.preventDefault(),document.location.toString().indexOf("cart")<0&&DT.mini_cart.openCart()}),$(document).on("click",".button-add-p, .button-buy, .button-add",function(t){t.preventDefault();var a=$(this).attr("data-rel")||$(this).attr("data-variant");console.log("[button-add] product_variant",$(this),a);var e={id:a,quantity:1,properties:{_compare_at_price:$("#variant").attr("data-compared")||$(this).attr("data-compared"),_is_main_product:!0,_is_free:$(this).attr("data-free")}};console.log("[button-add] product_variant",$(this),a);var r=$(this).attr("data-free")||"false";"false"!=r&&(a={id:r,quantity:1,properties:{_compare_at_price:0,_id_associated:a,_is_free_tB:!0}},DT.mini_cart.muestras_gratis.add(a)),DT.cart.add_to_cart(e,function(){$(t.target).hasClass("go-checkout")?DT.cart.checkout():DT.mini_cart.format_mini_cart(DT.mini_cart.openCart)})}),$(document).on("click","#cart_modal_checkout",function(t){t.preventDefault(),DT.cart.checkout()}),$(document).on("click","#cart_page_checkout",function(t){t.preventDefault(),DT.cart.checkout()}),$(document).on("click","#cart_modal_seguir",function(t){t.preventDefault(),DT.mini_cart.closeCart()}),$(".backdrop, .page-overlay").click(()=>{console.log("cart to close"),DT.mini_cart.closeCart()}),$(document).on("click",".close-cart,  .page-overlay",DT.mini_cart.closeCart)},muestras_gratis:{get:function(){let t=[];return window.localStorage.getItem("muestras_gratis")&&(t=JSON.parse(window.localStorage.getItem("muestras_gratis"))),t},add:function(t){let a=[];return window.localStorage.getItem("muestras_gratis")&&(a=JSON.parse(window.localStorage.getItem("muestras_gratis"))),a.push(t),window.localStorage.setItem("muestras_gratis",JSON.stringify(a)),a}},show:function(t=!1){console.log("[[[[ SHOW MINICART ]]]] update:",t),t&&DT.mini_cart.get_cart(function(){DT.mini_cart.format_mini_cart()&&DT.mini_cart.openCart()})},updateQty(e){var r="",t=e.data("q");let a;var r=e.hasClass("plus")?(a=+Number(t)+1,"plus"):e.hasClass("minus")?(a=+Number(t)-1,"minus"):(a=+Number(t)-1,-1==a&&(a=0),"remove"),o=e.data("rel"),t=$('.cart__item[data-associated="'+o+'"]').data("rel");0==a&&($('.minicart-items .cart__item[data-rel="'+o+'"]').addClass("evaporar"),$('.minicart-items .cart__item[data-associated="'+o+'"]').addClass("evaporar")),t=t?"updates["+o+"]="+a+"&updates["+t+"]="+a:"updates["+o+"]="+a,$.ajax({type:"POST",url:"/cart/update.js",data:t,dataType:"JSON",success:function(t){console.log("[[--update--]]",t);var a=t.items.find(t=>t.id===o);a?DT.data_layer.update(r,a):DT.data_layer.remove_product(e.data("handle")),e.hasClass("maincart")||e.hasClass("cartTemplate")?setTimeout(()=>{location.reload()},1e3):(DT.mini_cart.cart=t,DT.mini_cart.format_mini_cart())}})},openCart(){console.log("cart openCart"),$("#cart_modal").removeClass("close").addClass("open"),$(".page-overlay").addClass("is-visible"),$("html").addClass("no-scroll"),$("#cart_modal_checkout, #cart_modal_seguir, #shopping-number").show()},closeCart(){$("#cart_modal").removeClass("open").addClass("close"),$(".page-overlay").removeClass("is-visible"),$("html").removeClass("no-scroll")},get_cart:function(r=!1){console.log("[[[[ GET CART ]]]]"),$.get("/cart.json",function(t){console.log("[[[[ NEW CART ]]]]",t);let e=[];if(_.each(t.items,function(t){console.log("[CART]--\x3eITEM",t.properties._id_associated),t.properties._id_associated&&e.push(t.id)}),e.length){console.log("[CART]--\x3eBORRA MUESTRAS",e);let a=[];_.each(e,function(t){a.push("updates["+t+"]=0")}),console.log("[CART]--\x3eupdates",a.join("&")),$.ajax({type:"POST",url:"/cart/update.js",data:a.join("&"),dataType:"JSON",success:function(t){DT.mini_cart.cart=t,r&&r(t),console.log("FFFFFFFFFFFFFFFFFF",t)}})}else DT.mini_cart.cart=t,r&&r(t)})},format_mini_cart:function(t=!1){console.log("[[[[format_mini_cart]]]]",DT.mini_cart.cart),data=DT.mini_cart.cart,$("#cart_modal_inner").html("");var a=0;data.items.filter(t=>(0<t.price&&(a=parseInt(a+t.quantity)),!1)).length;if($("#shopping-number").find("span").text(a).show(),0===data.items.length)$("#cart_modal_inner,#cart_inner").html('<p class="minicart__title-empty section-title">'+DT.str.no_tienes_productos+"</p>").show(),$("#cart_modal_total,.cart_total,#minicart-header-banner,.minicart-buttons-box,#shopping-number").hide(),$("#cart_modal_totals_inner,#cart_modal_checkout, #cart_checkout, #cart_modal_seguir").hide(),$(".minicart-crossed-sell").hide(),$(".header-cart").removeClass("with_items"),$("#cart-bubble").addClass("hidden"),$(".minicart__qty-total,#cart_modal_totals_inner").text(""),$(".minicart__default_content").show();else{2<data.items.length&&$(".minicart-buttons-box").addClass("sombra"),$("#cart_modal").removeClass("cart-empty"),$(".minicart__qty-total").text("("+a+")"),$("#cart_modal_total,.cart_total,#minicart-header-banner,.minicart-buttons-box,.minicart-totals, .minicart-crossed-sell").show(),DT.mini_cart.envio_gratis(data.total_price),$(".header-cart").addClass("with_items"),$("#cart-bubble").removeClass("hidden");const s=_.template($("#cart_line_template").html()),c=DT.money_format;$("#cart_modal_inner").append('<div class="minicart-items"></div>'),_.each(data.items,function(t){var a,e,r,o,i;0!==t.final_line_price&&(t.handle=t.handle,t.img_url=t.image,a=(i=t.title.split("|"))[0],e=DT.str["Similar a"],r=DT.str.de,i=i[1]?(o=i[1].replace(e,"").split(r)[1],i[1].replace(e,"").split(r)[0]):"",t.title='<div style="width:100%">'+`<p><span class="mincart-title-top">${a} - ${e}</span><br>`+`<span class="minicart-product-name">${i} ${r} ${o=o||"Divain"}</span></p></div>`,t.try_title_top=`${DT.str.muestra_gratis} <span class="trybuy-modal">${DT.str.tryandbuy}</span><a class="info" href="${DT.str.trybuy_link}"><span>i</span></a>`,t.try_title_bottom=`${a} ${DT.str["Similar a"]} ${i} ${DT.str.de} ${o}`,"false"!==t.properties._is_free?t.sample=!0:t.sample=!1,t.try_title="",t.formatted_price=Shopify.formatMoney(t.final_line_price,c),t.quantity_txt=t.quantity+" Unidad",1<t.quantity&&(t.quantity_txt+="es"),0===t.total_discount?""!=t.properties._compare_at_price&&0!=t.properties._compare_at_price?t.discount_price='<span class="crossed-price">'+Shopify.formatMoney(t.properties._compare_at_price*t.quantity,c)+"</span>":t.discount_price="":t.discount_price='<span class="crossed-price">'+Shopify.formatMoney(t.final_line_price+t.total_discount,c)+"</span>",t=s(t),$(".minicart-items").append(t))});var e=Shopify.formatMoney(data.total_price,c),r=data.total_price-data.total_price/1.21,r=Shopify.formatMoney(r,c);DT.gastos_envio;data.total_price,window.envio_gratis_importe;var o=data.total_price,o=Shopify.formatMoney(o,c),i=(i=data.total_price+data.total_discount)===data.total_price?"":Shopify.formatMoney(i,c);DT.mini_cart.format_cross_sell(),$("#cart_modal_totals_inner").html('<div id="cart_modal_total" class="cart-totals cart_modal_total">  <div class="cart-totals-label">'+DT.str.total.toUpperCase()+' <span class="iva_incluido">('+DT.str.iva_incluido+": "+r+')</span></div>  <div class="cart-totals-value">'+o+"</div></div>").show(),$("#subtotal_price").html(e),$("#cart_modal_checkout, #cart_modal_seguir").show(),$("#cart_modal_inner").css("margin-bottom",0)}data.openCart&&DT.mini_cart.openCart(),t&&"function"==typeof t&&t()},format_cross_sell:function(){var t,a=window.cross_sell_products,e="";_.each(a,t=>{var a="";t.compare_price>t.price&&(a=`<span class="crossed-price">${t.price_format_compared}</span>`);t=`<div class="cart__item">
								<div class="cart__wrapper">
								<div class="cart__img">
								<a href="${t.url}"><img class="lazyload" data-src="${t.img}" alt="${t.title}"></a>
								</div>
								<div class="cart-content">
								<a href="${t.url}"><div style="width: 100%;"><p>
								<span class="mincart-title-top">${t.title_top} - ${window.similar_a}</span><br>
								<span class="minicart-product-name">${t.name}</span></p></div></a>
								<div class="crossed_price"><p style="font-weight: bold;">${a}
								<span>${t.price_format}</span></p>
								<button class="button button-add" data-free="${t.free}"
								data-compared="${t.compare_price}" data-variant="${t.id}">${window.buy_now}</button>
								</div></div></div></div>`;e+=t}),t=`<h4 class="crossed_product_title">${DT.str.completa_pedido}</h4>
						<div class="crossed-sell-slider">${e}</div>`,$("#cross-sell").html(t).show(),$(".crossed-sell-slider").flickity({prevNextButtons:!1,autoPlay:!0,wrapAround:!0})},envio_gratis:function(t){var a=100*window.envio_gratis_importe,e=((a-t)/100).toFixed(2),a=(1e3-1e3*(a-t)/a)/10;console.log(a),e=0<e?(e.replace(".",","),'<progress id="progress" max="100" value="'+a+'"></progress><p>'+window.envio_icon+window.envio_gratis_text.split("XX").join("<b>"+e+"</b>")+"</p>"):'<progress id="progress" max="100" value="100"></progress><p>'+window.envio_icon+window.envio_gratis_finish+"</p>",$(".envio-gratis").html(e)}},DT.data_layer={format_prod(t){var a=t.title.split("|"),e=DT.str["Similar a"],r=DT.str.de;r=a[1]?a[1].replace(e,"").split(r)[1]:"Divain";a=a[2];return prod={name:t.title,id:t.sku,price:t.final_price,brand:r=r||"Divain",category:a=a||"",quantity:1}},add(t,a){var e=this.format_prod(a);e.quantity=t.quantity;a={event:"addToCart",ecommerce:{currencyCode:"EUR",add:{products:[e]}}},t=dataLayer.findIndex(t=>"addToCart"===t.event);-1!=t?dataLayer[t].ecommerce.add.products.push(e):dataLayer.push(a)},update(t,a){a.title=a.product_title;var e=this.format_prod(a);if("plus"==t)for(let t=0;dataLayer.length>t;t++)"addToCart"==dataLayer[t].event&&dataLayer[t].ecommerce.add.products.push(e);else if("minus"==t)for(let t=0;dataLayer.length>t;t++)"removeFromCart"==dataLayer[t].event&&dataLayer[t].ecommerce.remove.products.push(e)},remove_product(t){$.ajax({type:"GET",url:"/products/"+t+".js",dataType:"JSON",success:function(t){var a=DT.data_layer.format_prod(t),e={event:"removeFromCart",ecommerce:{currencyCode:"EUR",remove:{products:[a]}}},t=dataLayer.findIndex(t=>"removeFromCart"===t.event);-1!=t?dataLayer[t].ecommerce.remove.products.push(a):dataLayer.push(e)}})}},DT.mini_cart.init();