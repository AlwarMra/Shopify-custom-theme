DT.muestras={init:function(){var t=this,e=$(".muestras-input-container"),n=$(".btn-muestras"),a=$(".input-wrapper"),r=$(".variant-price");$(".add_muestra").on("click",function(){t.addProduct(e)}),$("#add_to_cart_muestra").on("click",function(){t.addProduct(e,!0)}),n.on("click",function(){var t=$(this);n.removeClass("muestra-active"),t.addClass("muestra-active"),$("#variant").attr("value",t.attr("data-variant-id")),$("#variant").attr("data-variant",t.attr("data-variant")),e.hide();var a=e.slice();e.each(function(){if(variant=$(this).attr("data-variant"),variant==t.attr("data-variant"))return r.hide(),$('.variant-price[data-variant="'+variant+'"]').show(),a.length=parseInt(variant)+1,a.show(),!1})}),$(document).on("click",".close-tag",function(){t.removeTag(this)}),$(document).mouseup(function(t){a.is(t.target)||0!==a.has(t.target).length||a.find(".search-results").hide()}),$(".input-muestra").on("keyup",function(a,e){let n=0;return function(...t){clearTimeout(n),n=setTimeout(a.bind(this,...t),e||0)}}(function(t){var a=$(this),e="/search?q="+$(this).val()+"&view=ajax";fetch(e,{credentials:"same-origin",method:"GET"}).then(function(t){t.text().then(function(t){t=replaceAll(t,",]","]");window.products=JSON.parse(t),a.next().html(""),$(".search-results").hide(),a.next().show(),0===window.products.length?a.next().append('<p class="empty-search">No hay coincidencias</p>'):_.each(products,function(t){a.next().append('<a href="#" class="btn_add_muestra" data-pr_id="'+t.pr_id+'" data-title="'+t.title+'">'+t.title+"</a>")}),$(".btn_add_muestra").on("click",function(t){t.preventDefault(),$(this).parent().hide(),DT.muestras.addTag(this)})})})},300)),$(".input-wrapper .close").on("click",function(){$(this).parent().remove(),$(this).closest(".input-muestra").show()})},addTag:function(t){var a=t.getAttribute("data-title"),a='<span class="tag" data-muestra="'+a+'"><span class="tag-title">'+a+'</span><span class="close-tag"></span></span>';$(t).parent().siblings(".input-muestra").hide(),$(t).parent().siblings(".input-muestra").val(""),$(t).closest(".input-wrapper").prepend(a)},removeTag:function(t){var a=$(t).parent().siblings(".input-muestra");$(t).parent().remove(),a.show()},addProduct:function(t,a=!1){var e=[],n=$("#variant").attr("value"),r=parseInt($("#variant").attr("data-variant"))+1,i=parseInt($("#variant").attr("data-q")),t=t.slice();t.length=r,console.log(t);var s,t=t.find(".tag");t.length<6*r?($(".description-buttons .msg").fadeIn(),setTimeout(()=>{$(".description-buttons .msg").fadeOut()},2e3)):(e=[],t.each(function(){var t=$(this).attr("data-muestra").split("|");e.push(t[0])}),s={id:n,q:i,properties:{_compare_at_price:0,[DT.str.muestras]:e.join(" ")}},$.ajax({type:"POST",url:"/cart/add.js",data:s,dataType:"JSON",success:t=>{console.log("Product added>>",t),DT.data_layer.add(s,t),DT.mini_cart.get_cart(DT.mini_cart.format_mini_cart,!0),a?document.location="/checkout":DT.mini_cart.openCart()},error:()=>{console.log("error")}}))}},$(document).ready(()=>{DT.muestras.init()});